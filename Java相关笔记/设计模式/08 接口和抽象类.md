# 08 接口和抽象类

## 接口和抽象类的定义

### 抽象类的定义

Java中的关键字`abstract`

* 抽象类不允许被实例化，只能被继承。也就是说不能通过new 一个抽象类的对象出来。
* 抽象类可以包含属性和方法。方法既可以包含代码实现，也可以不包含代码实现。不包含代码实现的方法叫作抽象方法。
* 子类继承抽象类，必须实现抽象类中的所有抽象方法。

### 接口类的定义

Java中的关键字`interface`

* 接口不能包含属性（也就是成员变量）。
* 接口只能声明方法，方法不能包含代码实现。
* 类实现接口的适合，必须实现接口中声明的所有方法。

抽象类实际上就是类，只不过是一种特殊的类，这种类不能被实例化为对象，只能被子类继承。继承关系是一种`is-a`的关系，接口表示的是一种`has-a`关系，表示具有某些功能。对于接口有一个更加形象的叫法，那就是协议（contract）。

## 抽象类和接口能解决什么编程问题

* 抽象类能解决什么编程问题？

  抽象类只能被继承，可以解决代码复用问题。由于抽象类的抽象方法可以强制在实现类中实现，所以也有强制子类实现方法的作用，防止子类没有复写父类的方法出现调用问题。

* 接口类能解决什么编程问题？

  接口更侧重于解耦，接口是对行为的一种抽象，相当于一组协议或契约，接口实现了约定和实现相分离，可以降低代码间的耦合性，提高代码的可扩展性。

## 如何决定该用抽象类还是接口类

当表示一种`is-a`的关系，并且是为了解决代码复用问题，就使用抽象类；当表示一种`has-a`关系，并且是为了解决抽象而非代码复用问题，就使用接口类。从类的继承层次上看，抽象类是一种自下而上的设计思路，先有子类的代码复用，然后再抽象成上层的父类（也就是抽象类）。而接口正好相反，它是一种自上而下的设计思路，在编程的时候，一般都是先设计接口，再去考虑具体的实现。

## 基于接口而非实现编程

“基于接口而非实现编程”这条原则的因为描述是：“Program to an interface, not an implementation”。理解这条原则的时候，千万不要一开始就与具体的编程语言挂钩，局限在编程语言的“接口”语法中（比如 Java 中的 interface 接口语法）。这条原则最早出现于 1994 年 GoF 的《设计模式》这本书，它先于很多编程语言而诞生（比如 Java 语言），是一条比较抽象、泛化的设计思想。

理解这条原则的关键，就是理解其中的：“接口”两个字。从本质上来看，“接口”就是一组“协议”、“契约”、“约定”，是功能提供者给使用者的一个“功能列表”。“接口”在不同的应用场景下会有不同的解读，比如服务端与客户端之间的“接口”，类库提供的“接口”，甚至是一组通信的协议都可以叫作“接口”。刚刚对“接口”的理解，都比较偏上层、偏抽象，与实际的写代码离得有点远。如果落实到具体的编码，“基于接口而非实现编程”这条原则中的“接口”，可以理解为编程语言中的接口或者抽象类。

**这条原则为什么能有效地提高代码质量：**应用这条原则，可以将接口和实现相分离，封装不稳定的实现，暴露稳定的接口。上游系统面向接口而非实现编程，不依赖不稳定的实现，这样当实现发生变化时，上游系统的代码基本上不需要做改动，以此来降低耦合性，提高代码扩展性。

实际上，“基于接口而非实现编程”这条原则的另一个表述方式，是“基于抽象而非实现编程”。后者的表述方式其实更能体现这条原则的设计初衷。在软件开发中，最大的挑战之一就是需求的不断变化，这也是考验代码设计好坏的一个标准。**越抽象、越顶层、越脱离具体某一实现的设计，越能提高代码的灵活性，越能应对未来的需求变化。好的代码设计，不仅能应对当下的需求，而且在将来需求发生变化的时候，仍然能够在不破坏原有代码设计的情况下灵活应对。**而抽象就是提高代码扩展性、灵活性、可维护性最有效的手段之一。

### 在实战中怎么应用这个原则

在编写代码的时候，要遵从“基于接口而非实现编程”的原则，具体来讲，需要做到下面这 3 点：

* 1.函数的命名不能暴露任何实现细节。比如，前面提到的 uploadToAliyun() 就不符合要求，应该改为去掉 aliyun 这样的字眼，改为更加抽象的命名方式，比如：upload()。
* 2.封装具体的实现细节。比如，跟阿里云相关的特殊上传（或下载）流程不应该暴露给调用者。我们对上传（或下载）流程进行封装，对外提供一个包裹所有上传（或下载）细节的方法，给调用者使用。
* 3.为实现类定义抽象的接口。具体的实现类都依赖统一的接口定义，遵从一致的上传功能协议。使用者依赖接口，而不是具体的实现类来编程。

在做软件开发中，一定要有抽象意识、封装意识、接口意识。在定义接口的时候，不要暴露任何实现细节。接口的定义只表名做什么，而不是怎么做。而且在设计接口时，要多考虑一下，这一的接口设计是否足够通用，是否能够做到在提换具体实现的时候，不需要任何定义的改动。

### 是否需要为每个类定义接口

过度使用这条准则，非得给每个类都定义接口，也会导致不必要的开发负担。从设计初衷上来看，如果某个功能只有一种实现方式，未来也不可能被其他实现方式替换，那就没有必要为其设计接口，也咩呀必要基于接口编程，直接使用实现类就可以了。除此之外，越是不稳定的系统，越是要在代码的扩展性、维护性上下功夫。相反，如果某个系统特别稳定，在开发完之后，基本上不需要做维护，那就没有必要为其扩展性，投入不必要的开发时间。

**我的理解是，在第一次设计开发时，可能无法确定后续软件的变更，在发生变更时再去进行抽象处理。**
